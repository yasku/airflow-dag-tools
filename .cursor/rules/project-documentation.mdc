---
description: 
globs: 
---

# **üìå Documentaci√≥n Completa del Proyecto WebApp de Validaci√≥n de DAGs de Airflow**

## **üîπ Introducci√≥n**

Esta documentaci√≥n detalla la arquitectura, funcionalidad y configuraci√≥n de la WebApp de Validaci√≥n de DAGs de Airflow. La aplicaci√≥n permite a los usuarios cargar y validar DAGs de Airflow sin necesidad de ejecutar el servicio de Airflow, utilizando funciones como `DagBag` y el parser de Airflow.

La aplicaci√≥n se compone de dos partes principales:

*   **Backend:** Desarrollado con FastAPI, se encarga de recibir los archivos DAG, validarlos y retornar los resultados en formato JSON.
*   **Frontend:** Construido con Vite, React y Tailwind CSS, proporciona una interfaz de usuario para subir los DAGs y visualizar los resultados de la validaci√≥n.

---

## **üìå Arquitectura del Proyecto**

La arquitectura del proyecto sigue un patr√≥n cliente-servidor, donde el frontend act√∫a como cliente y el backend como servidor. La comunicaci√≥n entre ambos se realiza a trav√©s de una API REST.

```
/webapp
 ‚îú‚îÄ‚îÄ /backend
 ‚îÇ   ‚îú‚îÄ‚îÄ main.py               # Punto de entrada del backend (FastAPI)
 ‚îÇ   ‚îú‚îÄ‚îÄ dag_validator.py      # L√≥gica para validar DAGs
 ‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt      # Dependencias
 ‚îÇ   ‚îú‚îÄ‚îÄ documentacion-backend.md # Documentaci√≥n del backend
 ‚îÇ   ‚îú‚îÄ‚îÄ /tests                # Pruebas del backend
 ‚îÇ   ‚îú‚îÄ‚îÄ /dags                 # Carpeta donde se guardar√°n los DAGs subidos
 ‚îú‚îÄ‚îÄ /frontend
 ‚îÇ   ‚îú‚îÄ‚îÄ /src
 ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.jsx           # Componente principal
 ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.css           # Estilos globales
 ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.jsx          # Punto de entrada de React
 ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.css         # Estilos globales
 ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ /pages            # P√°ginas principales
 ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Home.jsx      # P√°gina de inicio
 ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Upload.jsx    # P√°gina para cargar DAGs
 ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Validate.jsx  # P√°gina de validaci√≥n
 ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ /components       # Componentes reutilizables
 ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Navbar.jsx    # Barra de navegaci√≥n
 ‚îÇ   ‚îú‚îÄ‚îÄ package.json          # Dependencias de React
 ‚îÇ   ‚îú‚îÄ‚îÄ tailwind.config.js    # Configuraci√≥n de Tailwind
 ‚îÇ   ‚îú‚îÄ‚îÄ postcss.config.js    # Configuraci√≥n de PostCSS
 ‚îÇ   ‚îú‚îÄ‚îÄ index.html          # P√°gina principal
 ‚îÇ   ‚îú‚îÄ‚îÄ vite.config.js        # Configuraci√≥n de Vite
 ‚îú‚îÄ‚îÄ /docs
 ‚îÇ   ‚îú‚îÄ‚îÄ INSTRUCCIONES.md      # Gu√≠a de instalaci√≥n y uso
 ‚îÇ   ‚îú‚îÄ‚îÄ CHANGELOG.md          # Registro de cambios
 ‚îú‚îÄ‚îÄ Etapas de Desarrollo.md   # Etapas de desarrollo del proyecto
 ‚îú‚îÄ‚îÄ Estructura del Proyecto.md   # Estructura del proyecto
```

---

## **üìå Backend (FastAPI)**

### **‚öôÔ∏è Funcionalidad**

El backend, desarrollado con FastAPI, tiene las siguientes funciones principales:

1.  **Recibir archivos DAG:** A trav√©s de un endpoint (`/validate_dag/`), el backend recibe archivos DAG en formato `.py` desde el frontend.
2.  **Guardar archivos DAG:** Los archivos recibidos se guardan temporalmente en la carpeta `/dags`.
3.  **Validar DAGs:** Utiliza el m√≥dulo `dag_validator.py` para validar la sintaxis y estructura del DAG.
4.  **Retornar resultados:** Devuelve una respuesta estructurada en JSON, indicando si el DAG es v√°lido o, en caso contrario, los errores encontrados.

### **üõ†Ô∏è Instalaci√≥n y Configuraci√≥n**

1.  **Requisitos Previos:**
    *   WSL2 Ubuntu 22.04 (si est√°s en Windows).
    *   Python 3.9+.
    *   Pip y Virtualenv.
    *   FastAPI y Uvicorn.
    *   Apache Airflow 2.5 (sin ejecutar el servicio).
2.  **Instalaci√≥n:**

    ```bash
    cd backend
    python3 -m venv venv
    source venv/bin/activate
    pip install -r requirements.txt
    ```
3.  **Iniciar el Backend:**

    ```bash
    uvicorn main:app --reload
    ```

    Esto iniciar√° el backend en ``.

### **üìÇ Estructura de Archivos**

*   **`main.py` (startLine: 48, endLine: 49):** Punto de entrada de la API FastAPI. Define las rutas y gestiona la recepci√≥n y validaci√≥n de DAGs.
*   **`dag_validator.py` (startLine: 54, endLine: 55):** M√≥dulo que contiene la l√≥gica para validar los DAGs, incluyendo la verificaci√≥n de sintaxis con `ast` y la validaci√≥n de la estructura con `DagBag`.
*   **`requirements.txt` (startLine: 54, endLine: 55):** Lista de dependencias necesarias para ejecutar el backend.
*   **`/dags` (startLine: 56, endLine: 57):** Carpeta donde se guardan los DAGs subidos para su validaci√≥n.
*   **`/tests` (startLine: 56, endLine: 57):** (Opcional) Carpeta para pruebas unitarias del backend.

### **üîë Explicaci√≥n de los Archivos Clave**

#### **`main.py`**

Este archivo es el punto de entrada de la API FastAPI. Define las rutas y gestiona la recepci√≥n y validaci√≥n de DAGs.

*   **Funcionalidad:**
    *   Recibe archivos DAG `.py` desde el frontend.
    *   Guarda los archivos en la carpeta `/dags`.
    *   Llama a `dag_validator.py` para analizar y validar el DAG.
    *   Devuelve el resultado en formato JSON.
*   **Endpoints:**

    *   `@app.get("/")`
    *   `@app.post("/validate_dag/")` (startLine: 68, endLine: 70)

#### **`dag_validator.py`**

Este m√≥dulo contiene la l√≥gica para validar los DAGs.

*   **Funcionalidad:**
    *   Verifica si el c√≥digo tiene errores de sintaxis con `ast`.
    *   Usa `DagBag` para validar la estructura del DAG en Airflow.
    *   Extrae errores y los formatea para una mejor comprensi√≥n.
*   **Funciones principales:**

    *   `validate_python_syntax(file_path)` (startLine: 82, endLine: 83): Valida la sintaxis de Python.
    *   `validate_dag(file_path)` (startLine: 83, endLine: 84): Valida la estructura del DAG en Airflow.

### **üíª Uso de la API**

1.  **Probar en el Navegador:**

    Abrir `/docs` para probar la API con Swagger UI.
2.  **Subir un DAG y Validarlo:**

    Ejemplo de petici√≥n con `curl`:

    ```bash
    curl -X 'POST' '/validate_dag/' \
     -F 'file=@simple_dag.py'
    ```

    Ejemplo de respuesta si el DAG es v√°lido:

    ```json
    {
      "valid": true,
      "message": "El DAG es v√°lido."
    }
    ```

    Ejemplo de respuesta si hay errores:

    ```json
    {
      "valid": false,
      "error": {
        "type": "SyntaxError",
        "line": 5,
        "message": "invalid syntax",
        "file": "invalid_dag.py"
      }
    }
    ```

### **üìÑ Ejemplo de `main.py`**

```python:backend/main.py
startLine: 1
endLine: 39
```

### **üìÑ Ejemplo de `dag_validator.py`**

```python:backend/dag_validator.py
startLine: 1
endLine: 28
```

---

## **üìå Frontend (Vite + React + Tailwind CSS)**

### **‚öôÔ∏è Funcionalidad**

El frontend, construido con Vite, React y Tailwind CSS, proporciona una interfaz de usuario para:

1.  **Subir archivos DAG:** Permite a los usuarios seleccionar y subir archivos DAG en formato `.py`.
2.  **Mostrar contenido del DAG:** Muestra el contenido del archivo DAG subido en la pantalla.
3.  **Enviar DAG al backend:** Env√≠a el archivo DAG al backend para su validaci√≥n.
4.  **Mostrar resultados de validaci√≥n:** Muestra el resultado de la validaci√≥n, incluyendo errores detallados si el DAG es inv√°lido.

### **üõ†Ô∏è Instalaci√≥n y Configuraci√≥n**

1.  **Requisitos Previos:**
    *   Node.js versi√≥n 18 o superior.
    *   npm o yarn instalado.
    *   Backend en ejecuci√≥n (`uvicorn main:app --reload`).
2.  **Instalaci√≥n:**

    ```bash
    cd frontend
    npm install
    ```
3.  **Iniciar el Frontend:**

    ```bash
    npm run dev
    ```

    Esto iniciar√° el frontend en `http://localhost:5173`.

### **üìÇ Estructura de Archivos**

*   **`App.jsx` (startLine: 35, endLine: 36):** Componente principal de la aplicaci√≥n. Define las rutas y la estructura general.
*   **`main.jsx` (startLine: 41, endLine: 42):** Punto de entrada de React.
*   **`index.css` (startLine: 41, endLine: 42):** Estilos globales de Tailwind CSS.
*   **`App.css` (startLine: 43, endLine: 44):** Estilos espec√≠ficos de la aplicaci√≥n.
*   **`/pages` (startLine: 44, endLine: 45):**
    *   `Home.jsx` (startLine: 45, endLine: 46): P√°gina de inicio.
    *   `Upload.jsx` (startLine: 46, endLine: 47): P√°gina para subir DAGs.
    *   `Validate.jsx` (startLine: 47, endLine: 48): P√°gina para mostrar los resultados de la validaci√≥n.
*   **`/components` (startLine: 48, endLine: 49):**
    *   `Navbar.jsx` (startLine: 49, endLine: 50): Barra de navegaci√≥n.
*   **`package.json` (startLine: 50, endLine: 51):** Dependencias de React.
*   **`tailwind.config.js` (startLine: 51, endLine: 52):** Configuraci√≥n de Tailwind CSS.
*   **`postcss.config.cjs` (startLine: 52, endLine: 53):** Configuraci√≥n de PostCSS.
*   **`index.html` (startLine: 53, endLine: 54):** P√°gina principal HTML.
*   **`vite.config.js` (startLine: 54, endLine: 55):** Configuraci√≥n de Vite.

### **üîë Explicaci√≥n de los Archivos Clave**

#### **`App.jsx`**

Este archivo es el componente principal de la aplicaci√≥n.

*   **Funcionalidad:**
    *   Define las rutas principales con `react-router-dom`.
    *   Incluye el `Navbar` y las p√°ginas de la app.

```javascript:frontend/src/App.jsx
startLine: 1
endLine: 24
```

#### **`Navbar.jsx`**

Este archivo define la barra de navegaci√≥n.

*   **Funcionalidad:**
    *   Barra de navegaci√≥n con enlaces a las secciones principales.

```javascript:frontend/src/App.jsx
startLine: 1
endLine: 7
```

#### **`Upload.jsx`**

Este archivo contiene la l√≥gica para subir archivos DAG.

*   **Funcionalidad:**
    *   Permite seleccionar un archivo DAG desde el sistema de archivos.
    *   Muestra el contenido del archivo DAG.
    *   Env√≠a el archivo DAG al backend para su validaci√≥n.

#### **`Validate.jsx`**

Este archivo muestra los resultados de la validaci√≥n.

*   **Funcionalidad:**
    *   Recibe los resultados de la validaci√≥n desde el backend.
    *   Muestra un mensaje indicando si el DAG es v√°lido o no.
    *   Si el DAG no es v√°lido, muestra los errores detallados.

### **üé® Estilos con Tailwind CSS**

El frontend utiliza Tailwind CSS para los estilos. Tailwind CSS es un framework CSS utility-first que permite crear interfaces de usuario de forma r√°pida y sencilla.

*   **`tailwind.config.js`:** Este archivo contiene la configuraci√≥n de Tailwind CSS. Define las rutas de los archivos que se van a escanear para aplicar los estilos de Tailwind.

    ```javascript
    export default {
      content: [
        "./index.html",
        "./src/**/*.{js,jsx,ts,tsx}"
      ],
      theme: {
        extend: {},
      },
      plugins: [],
    };
    ```

*   **`index.css`:** Este archivo importa los estilos base de Tailwind CSS.

    ```css
    @tailwind base;
    @tailwind components;
    @tailwind utilities;
    ```

### **üíª Uso del Frontend**

1.  **Subir un DAG y Validarlo:**

    Desde la p√°gina `Upload.jsx`, se env√≠a un archivo al backend para su validaci√≥n.

    ```javascript
    const handleUpload = async () => {
      const formData = new FormData();
      formData.append("file", file);
      try {
        const response = await fetch("/validate_dag/", {
          method: "POST",
          body: formData,
        });
        const result = await response.json();
        console.log(result);
      } catch (error) {
        console.error("Error al subir el DAG:", error);
      }
    };
    ```

    El resultado se muestra en `Validate.jsx`.

---

## **üìå Flujo de Validaci√≥n**

1.  El usuario sube un archivo DAG a trav√©s del frontend (`Upload.jsx`).
2.  El frontend env√≠a el archivo al backend (`/validate_dag/`).
3.  El backend guarda el archivo en la carpeta `/dags`.
4.  El backend llama a la funci√≥n `validate_dag` en `dag_validator.py` para validar el DAG.
5.  `validate_dag` utiliza `validate_python_syntax` para verificar la sintaxis de Python.
6.  `validate_dag` utiliza `DagBag` para validar la estructura del DAG en Airflow.
7.  El backend retorna el resultado de la validaci√≥n en formato JSON.
8.  El frontend recibe el resultado y lo muestra en la p√°gina `Validate.jsx`.

---

## **üìå Conclusi√≥n**

Esta documentaci√≥n proporciona una visi√≥n completa de la WebApp de Validaci√≥n de DAGs de Airflow. Describe la arquitectura, funcionalidad, configuraci√≥n y uso de la aplicaci√≥n, as√≠ como la estructura de archivos y el flujo de validaci√≥n. Esta informaci√≥n es esencial para el mantenimiento, la mejora y la expansi√≥n de la aplicaci√≥n en el futuro.
```
